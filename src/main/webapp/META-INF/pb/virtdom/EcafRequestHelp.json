{
   "codePut": "/* Formatted on 26/09/2019 21:08:52 (QP5 v5.185.11230.41888) */\r\nDECLARE\r\n   l_seqno           skrecaf.skrecaf_seqno%TYPE;\r\n   l_rowid_out       ROWID;\r\n   l_encrypted_tfn   skrecaf.skrecaf_tfn%TYPE;\r\nBEGIN\r\n   SELECT NVL (MAX (SKRECAF_SEQNO) + 1, 1)\r\n     INTO l_seqno\r\n     FROM SKRECAF\r\n    WHERE SKRECAF_PIDM = :parm_user_pidm;\r\n\r\n   IF :TFN IS NOT NULL\r\n   THEN\r\n      gspcrpt.p_apply (:TFN, l_encrypted_tfn);\r\n   END IF;\r\n\r\nUPDATE SKRECAF\r\nSET SKRECAF_CURRENT_IND='N'\r\nWHERE SKRECAF_PIDM=:parm_user_pidm\r\nAND SKRECAF_PROGRAM=:program\r\nAND SKRECAF_HELP_TYPE=:helptype;\r\n\r\nIF :helptype in('H', 'F', 'S')\r\n   THEN\r\n\r\n   -- HECS see skkecaf.p_cre_sktecaf_rec and skkecaf.p_hconfirm_skrecaf_ins\r\n   -- FEE-HELP  see skkecaf.p_feehelp_sktecaf_rec and skkecaf.p_fhconfirm_skrecaf_ins\r\n   -- SA-HELP see skkecaf.p_saconfirm_skrecaf_ins and skkecaf.p_sahelp_sktecaf_rec\r\n  \r\n   -- add logic to compute the NZ and AUST indicators .... the logic differs by help type see procedures for sktecaf inserts\r\n      --    DECODE('ECAF_NZP' ,'YES','Y',NULL) and DECODE('ECAF_NZP' ,'YES','Y','YESNS','Y','YESNH','Y',NULL) );\r\n\r\n      SKKB_SKRECAF.P_CREATE (\r\n         P_SEQNO            => l_seqno,\r\n         P_PIDM             => :parm_user_pidm,\r\n         P_TERM_CODE        => :term,\r\n         P_PROGRAM          => :program,\r\n         P_ELIGIBILITY      => :helptype,\r\n         P_HELP_TYPE        => :helptype,\r\n         P_SIGNATURE_DATE   => SYSDATE,\r\n         P_AGREED           => 'Y',\r\n         P_SOURCE           => 'SELF-SERVICE',\r\n         P_CURRENT_IND      => 'Y',\r\n         P_PRE_2005_PELS    => 'N',\r\n         P_REPORTED_IND     => 'N',\r\n         P_USER_ID          => f_getspridenid (:parm_user_pidm),\r\n         P_TFN              => l_encrypted_tfn,\r\n         P_TFN_REQUESTED    => :TFN_REQUESTED,\r\n         p_nz_eligible      => '*',                                 -- MISSING\r\n         p_study_aust_ind   => '*',                                 -- MISSING\r\n         P_ROWID_OUT        => l_rowid_out);\r\n   --\r\n   --\r\n   -- OS-HELP see skkecaf.p_oshconfirm_skrecaf_ins and skkecaf.p_cre_os_help_rec\r\n   ELSIF :helptype = 'O'\r\n   THEN\r\n\r\n      -- add logic for Add/Replace choice of the student\r\n      --      IF student said replace THEN\r\n      --         UPDATE skrecaf SET skrecaf_current_ind = 'N' WHERE skrecaf_pidm = :parm_user_pidm AND skrecaf_seqno = l_seqno-1;\r\n      --      END IF;\r\n\r\n      SKKB_SKRECAF.P_CREATE (\r\n         P_SEQNO                 => l_seqno,\r\n         P_PIDM                  => :parm_user_pidm,\r\n         P_TERM_CODE             => :term,\r\n         P_PROGRAM               => :program,\r\n         P_ELIGIBILITY           => :helptype,\r\n         P_HELP_TYPE             => :helptype,\r\n         P_SIGNATURE_DATE        => SYSDATE,\r\n         P_AGREED                => 'Y',\r\n         P_SOURCE                => 'SELF-SERVICE',\r\n         P_CURRENT_IND           => 'Y',\r\n         P_PRE_2005_PELS         => 'N',\r\n         P_REPORTED_IND          => 'N',\r\n         P_USER_ID               => f_getspridenid (:parm_user_pidm),\r\n         P_TFN                   => :TFN,\r\n         P_TFN_REQUESTED         => :TFN_REQUESTED,\r\n         p_os_help_amount        => :OS_HELP,                           -- MISSING\r\n         p_os_study_start_date   => :OS_STUDY_DATE,                           -- MISSING\r\n         p_lang_amount           => :LANG_AMT,                           -- MISSING\r\n         p_asia_study_ind        => :ASIA_STUDY,                           -- MISSING\r\n         p_lang_code             => :LAND_CODE,                           -- MISSING\r\n         p_lang_start_date       => :LANG_START_DATE,                           -- MISSING DECODE('ECAF_NZP', 'YES','Y',NULL)\r\n         p_nz_eligible      => '*',                                 -- MISSING\r\n         p_study_aust_ind        => NULL,   \r\n         P_ROWID_OUT             => l_rowid_out);\r\n   END IF;\r\nEND;",
   "codeDelete": null,
   "virtualDomainRoles": [
      {
         "allowDelete": false,
         "allowPost": true,
         "allowPut": true,
         "roleName": "ALLROLES",
         "allowGet": true
      }
   ],
   "codeGet": "SELECT 1 AS ID,\r\n       SPRIDEN_LAST_NAME,\r\n       SPRIDEN_FIRST_NAME,\r\n       TO_CHAR(SPBPERS_BIRTH_DATE, 'DD Mon YYYY') AS BIRTH_DATE,\r\n       CASE WHEN SPBPERS_SEX = 'M' then 'Male'\r\n            WHEN SPBPERS_SEX = 'F' then 'Female'\r\n            ELSE 'Unknown' END AS SPBPERS_SEX,\r\n       (SELECT GUBINST_NAME FROM GUBINST) AS INSTITUTE_NAME,\r\n       STVCAMP_DESC,\r\n       SPRIDEN_ID,\r\n       SKRDRCO_CRS_STUDY_NAME,\r\n       STVCITZ_DESC,\r\n       CASE\r\n       WHEN :helptype = 'H' THEN 'Commonwealth Support and HECS-HELP effective from'||' '||:term\r\n       WHEN :helptype = 'F' THEN 'FEE-HELP effective from'||' '||:term\r\n       WHEN :helptype = 'O' THEN 'OS-HELP effective from'||' '||:term\r\n       WHEN :helptype = 'S' THEN 'SA-HELP effective from'||' '||:term\r\n        ELSE 'No Current Commonwealth Support'\r\n        END as ASSISTANCE\r\n  FROM SPRIDEN\r\n       INNER JOIN SPBPERS\r\n          ON SPRIDEN_PIDM = SPBPERS_PIDM\r\n       INNER JOIN SOVLCUR\r\n          ON     SPRIDEN_PIDM = SOVLCUR_PIDM\r\n             AND SOVLCUR_LMOD_CODE = 'LEARNER'\r\n             AND SOVLCUR_TERM_CODE = :term\r\n             AND SOVLCUR_PROGRAM = :program\r\n             AND SOVLCUR_CURRENT_IND = 'Y'\r\n             AND SOVLCUR_ACTIVE_IND = 'Y'\r\n       INNER JOIN SKRDRCO\r\n          ON     SOVLCUR_PROGRAM = SKRDRCO_PROGRAM\r\n             AND SKRDRCO_TERM_CODE_EFF =\r\n                    (SELECT MAX (SKRDRCO_TERM_CODE_EFF)\r\n                       FROM SKRDRCO\r\n                      WHERE     SKRDRCO_PROGRAM = SOVLCUR_PROGRAM\r\n                            AND SKRDRCO_TERM_CODE_EFF <= SOVLCUR_TERM_CODE)\r\n       LEFT JOIN STVCAMP\r\n          ON SOVLCUR_CAMP_CODE = STVCAMP_CODE\r\n       LEFT JOIN STVCITZ\r\n          ON SPBPERS_CITZ_CODE = STVCITZ_CODE\r\n WHERE SPRIDEN_PIDM = :parm_user_pidm \r\n AND SPRIDEN_CHANGE_IND IS NULL",
   "typeOfCode": "S",
   "fileTimestamp": null,
   "serviceName": "EcafRequestHelp",
   "codePost": null
}